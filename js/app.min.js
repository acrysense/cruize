"use strict";

document.addEventListener('DOMContentLoaded', function () {
  // function's
  function bodyFixScroll(status) {
    var scrollPosition = 0;
    var paddingOffset = window.innerWidth - document.body.offsetWidth + 'px';
    var elementsFixed = document.querySelectorAll('.fixed');
    if (status) {
      document.body.classList.add('scroll-disabled');
      scrollPosition = window.pageYOffset;
      document.body.style.overflow = 'hidden';
      document.body.style.position = 'fixed';
      if (document.body.style.top) {
        document.body.style.top = document.body.style.top;
      } else {
        document.body.style.top = '-' + scrollPosition + 'px';
      }
      document.body.style.width = '100%';
      document.body.style.paddingRight = paddingOffset;
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.marginRight = paddingOffset;
        });
      }
    } else {
      document.body.classList.remove('scroll-disabled');
      scrollPosition = Math.abs(parseInt(document.querySelector('body').style.top.replace('px', '')));
      document.body.style.removeProperty('overflow');
      document.body.style.removeProperty('position');
      document.body.style.removeProperty('top');
      document.body.style.removeProperty('width');
      document.body.style.removeProperty('padding-right');
      if (elementsFixed) {
        elementsFixed.forEach(function (item) {
          item.style.removeProperty('margin-right');
        });
      }
      window.scrollTo({
        top: !isNaN(scrollPosition) ? scrollPosition : 0,
        behavior: 'instant'
      });
    }
  }
  function activateDecksTab(tab) {
    document.querySelectorAll('.decks-tabs__item').forEach(function (item) {
      item.classList.remove('is--active');
    });
    var parentItem = tab.closest('.decks-tabs__item');
    if (parentItem) {
      parentItem.classList.add('is--active');
    }
    decksImages[0].src = tab.dataset.profile;
    decksImages[1].src = tab.dataset.deck;
  }

  // checker
  var useItemChecker = function useItemChecker(els, onClickOutside) {
    var isActive = false;
    var checkBodyClick = function checkBodyClick(e) {
      var currentEl = e.target;
      while (currentEl) {
        if (els.includes(currentEl)) return;
        currentEl = currentEl.parentNode;
      }
      onClickOutside();
      removeBodyChecker();
    };
    function setBodyChecker() {
      if (!isActive) {
        document.documentElement.addEventListener('click', checkBodyClick);
        isActive = true;
      }
    }
    function removeBodyChecker() {
      if (isActive) {
        document.documentElement.removeEventListener('click', checkBodyClick);
        isActive = false;
      }
    }
    return {
      setBodyChecker: setBodyChecker,
      removeBodyChecker: removeBodyChecker
    };
  };

  // inputmask
  Inputmask().mask(document.querySelectorAll('input'));

  // textarea
  var allTexareas = document.querySelectorAll('textarea');
  if (allTexareas) {
    allTexareas.forEach(function (el) {
      el.style.height = el.setAttribute('style', 'height: ' + el.scrollHeight + 'px');
      el.classList.add('auto');
      el.addEventListener('input', function (e) {
        el.style.height = 'auto';
        el.style.height = el.scrollHeight + 'px';
      });
    });
  }

  // mobile menu
  var mobileMenu = document.getElementById('mobile-menu');
  var mobileMenuTrigger = document.getElementById('hamburger-toggle');
  if (mobileMenu && mobileMenuTrigger) {
    mobileMenuTrigger.addEventListener('click', function (event) {
      event.preventDefault();
      if (mobileMenu.classList.contains('is--active')) {
        mobileMenuTrigger.classList.remove('is--active');
        mobileMenu.classList.remove('is--active');
        bodyFixScroll(0);
      } else {
        mobileMenuTrigger.classList.add('is--active');
        mobileMenu.classList.add('is--active');
        bodyFixScroll(1);
      }
    });
  }

  // decks tabs
  var decksTabs = document.querySelectorAll('.decks-tabs__tab');
  var decksImages = document.querySelectorAll('.decks__image img');
  if (decksTabs && decksImages) {
    if (decksTabs.length > 0 || decksImages.length == 2) {
      decksTabs.forEach(function (tab) {
        tab.addEventListener('click', function () {
          activateDecksTab(this);
        });
      });
      activateDecksTab(decksTabs[0]);
    }
  }

  // main slider
  var mainSlider = document.querySelector('.main__slider .swiper');
  if (mainSlider) {
    var myMainSlider = new Swiper(mainSlider, {
      slidesPerView: 1,
      loop: true,
      autoplay: {
        delay: 5000
      }
    });
  }

  // fleet slider
  var fleetSlider = document.querySelector('.fleet__slider .swiper');
  if (fleetSlider) {
    var myFleetSlider = new Swiper(fleetSlider, {
      slidesPerView: 3,
      spaceBetween: 143,
      loop: true,
      centeredSlides: true,
      navigation: {
        prevEl: '.fleet__slider .swiper-button-prev',
        nextEl: '.fleet__slider .swiper-button-next'
      },
      breakpoints: {
        0: {
          slidesPerView: 1,
          spaceBetween: 20
        },
        744: {
          slidesPerView: 3,
          spaceBetween: 60
        },
        1024: {
          slidesPerView: 3,
          spaceBetween: 143
        }
      }
    });
  }

  // directions slider
  var directionsSlider = document.querySelector('.directions__slider .swiper');
  if (directionsSlider) {
    var myDirectionsSlider = new Swiper(directionsSlider, {
      slidesPerView: 1,
      loop: true,
      navigation: {
        prevEl: '.directions__slider .swiper-button-prev',
        nextEl: '.directions__slider .swiper-button-next'
      }
    });
  }

  // cruises slider
  var cruisesSlider = document.querySelector('.cruises__slider .swiper');
  if (cruisesSlider) {
    var myCruisesSlider = new Swiper(cruisesSlider, {
      slidesPerView: 2,
      spaceBetween: 32,
      loop: true,
      navigation: {
        prevEl: '.cruises__slider .swiper-button-prev',
        nextEl: '.cruises__slider .swiper-button-next'
      },
      breakpoints: {
        0: {
          slidesPerView: 1,
          spaceBetween: 20
        },
        744: {
          slidesPerView: 1,
          spaceBetween: 16
        },
        1024: {
          slidesPerView: 2,
          spaceBetween: 32
        }
      }
    });
  }

  // cabins slider
  var cabinsSlider = document.querySelector('.cabins__slider .swiper');
  if (cabinsSlider) {
    var myCabinsSlider = new Swiper(cabinsSlider, {
      slidesPerView: 1,
      spaceBetween: 0,
      loop: true,
      navigation: {
        prevEl: '.cabins__slider .swiper-button-prev',
        nextEl: '.cabins__slider .swiper-button-next'
      },
      pagination: {
        el: '.cabins__slider .swiper-pagination',
        clickable: true
      }
    });
  }

  // main filter dropdown
  var mainFilterItemTrigger = document.querySelectorAll('.main-filter__item');
  if (mainFilterItemTrigger.length) {
    var activeItem = null;
    var activeChecker = null;
    mainFilterItemTrigger.forEach(function (item) {
      var dropdown = document.querySelector(".main-filter__dropdown--".concat(item.dataset.id));
      var close = function close() {
        mainFilterItemTrigger.forEach(function (child) {
          return child.classList.remove('is--active');
        });
        document.querySelectorAll('.main-filter__dropdown').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        if (activeChecker) activeChecker.removeBodyChecker();
        activeItem = null;
        activeChecker = null;
      };
      var itemChecker = useItemChecker([item, dropdown], close);
      item.addEventListener('click', function (event) {
        event.preventDefault();
        if (item === activeItem) {
          close();
        } else {
          close();
          item.classList.add('is--active');
          dropdown.classList.add('is--active');
          itemChecker.setBodyChecker();
          activeItem = item;
          activeChecker = itemChecker;
        }
      });
    });
  }

  // main filter calendar
  var mainFilterCalendar = document.querySelector('.main-filter-calendar');
  if (mainFilterCalendar) {
    var createCalendar = function createCalendar(year) {
      var yearContainer = document.createElement('div');
      yearContainer.classList.add('year-container');
      var yearTitle = document.createElement('span');
      yearTitle.textContent = year;
      yearTitle.classList.add('year-title');
      yearContainer.appendChild(yearTitle);
      var monthsContainer = document.createElement('div');
      monthsContainer.classList.add('months-container');
      var months = ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'];
      months.forEach(function (month, index) {
        var monthElement = document.createElement('div');
        monthElement.classList.add('month');
        monthElement.textContent = month;
        monthElement.dataset.year = year;
        monthElement.dataset.month = index + 1;
        if (year < currentYear || year === currentYear && index < new Date().getMonth()) {
          monthElement.classList.add('disabled');
        } else {
          monthElement.addEventListener('click', handleMonthClick);
        }
        monthsContainer.appendChild(monthElement);
      });
      yearContainer.appendChild(monthsContainer);
      return yearContainer;
    };
    var handleMonthClick = function handleMonthClick(event) {
      var monthElement = event.target;
      var year = parseInt(monthElement.dataset.year);
      var month = parseInt(monthElement.dataset.month);
      if (!startSelection) {
        startSelection = {
          year: year,
          month: month,
          element: monthElement
        };
        monthElement.classList.add('selected');
      } else if (!endSelection) {
        if (year < startSelection.year || year === startSelection.year && month < startSelection.month) {
          startSelection.element.classList.remove('selected');
          startSelection = {
            year: year,
            month: month,
            element: monthElement
          };
          monthElement.classList.add('selected');
        } else {
          endSelection = {
            year: year,
            month: month,
            element: monthElement
          };
          highlightRange();
        }
      } else {
        clearSelection();
        startSelection = {
          year: year,
          month: month,
          element: monthElement
        };
        monthElement.classList.add('selected');
      }
      logSelection();
    };
    var highlightRange = function highlightRange() {
      document.querySelectorAll('.month').forEach(function (el) {
        return el.classList.remove('selected');
      });
      startSelection.element.classList.add('selected');
      endSelection.element.classList.add('selected');
      document.querySelectorAll('.month').forEach(function (el) {
        var elYear = parseInt(el.dataset.year);
        var elMonth = parseInt(el.dataset.month);
        if ((elYear > startSelection.year || elYear === startSelection.year && elMonth >= startSelection.month) && (elYear < endSelection.year || elYear === endSelection.year && elMonth <= endSelection.month)) {
          el.classList.add('selected');
        }
      });
    };
    var clearSelection = function clearSelection() {
      startSelection = null;
      endSelection = null;
      document.querySelectorAll('.month').forEach(function (el) {
        return el.classList.remove('selected');
      });
    };
    var logSelection = function logSelection() {
      var months = ['Янв', 'Фев', 'Мар', 'Апр', 'Май', 'Июн', 'Июл', 'Авг', 'Сен', 'Окт', 'Ноя', 'Дек'];
      if (startSelection && !endSelection) {
        console.log("".concat(months[startSelection.month - 1], " ").concat(startSelection.year));
      } else if (startSelection && endSelection) {
        console.log("".concat(months[startSelection.month - 1], " ").concat(startSelection.year, " - ").concat(months[endSelection.month - 1], " ").concat(endSelection.year));
      }
    };
    var calendarContainer = document.getElementById('main-filter-calendar');
    var currentYear = new Date().getFullYear();
    var startSelection = null;
    var endSelection = null;
    document.querySelector('.main-filter-calendar__clear').addEventListener('click', clearSelection);
    [currentYear - 1, currentYear, currentYear + 1].forEach(function (year) {
      calendarContainer.appendChild(createCalendar(year));
    });
  }

  // modal
  var modal = document.querySelectorAll('.modal');
  var modalBtn = document.querySelectorAll('.modal-btn');
  var modalClose = document.querySelectorAll('.modal__close');
  if (modal && modalBtn && modalClose) {
    // modal
    modal.forEach(function (item) {
      item.addEventListener('click', function (event) {
        if (event.target.classList.contains('modal') || event.target.classList.contains('modal__wrap')) {
          event.preventDefault();
          document.querySelectorAll('.modal.is--active').forEach(function (child) {
            return child.classList.remove('is--active');
          });
          document.body.classList.remove('scroll-disabled');
        }
      });
    });

    // modal btn
    modalBtn.forEach(function (item, i) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        var modalID = item.dataset.id;
        document.querySelectorAll('.modal.is--active').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        document.getElementById(modalID).classList.add('is--active');
        document.body.classList.add('scroll-disabled');
      });
    });

    // modal close
    modalClose.forEach(function (item) {
      item.addEventListener('click', function (event) {
        event.preventDefault();
        document.querySelectorAll('.modal.is--active').forEach(function (child) {
          return child.classList.remove('is--active');
        });
        document.body.classList.remove('scroll-disabled');
      });
    });
  }
});